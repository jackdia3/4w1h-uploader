# 4W1H 產品頁面 HTML 結構分析報告

## 📊 分析總覽

分析了 11 個產品的 `raw.html` 檔案，發現 HTML 結構高度一致，適合使用統一的
selector 配置進行資料抓取。

## 🔍 主要發現

### 1. 結構一致性

- **優點**：所有產品頁面都遵循相同的 HTML 結構模板
- **挑戰**：少數欄位（如 notices）在大部分產品中不存在

### 2. 特殊情況

- **ladle (4w1h_009)**：產品代碼使用全形字元 `４ｗ１ｈ`
- **gyouza-pan**：規格表中缺少產品代碼的值
- **YouTube 影片**：部分產品的 features 包含嵌入式影片

### 3. 缺失欄位統計

| 欄位          | 缺失產品數 | 備註                          |
| ------------- | ---------- | ----------------------------- |
| notices       | 10/11      | 只有 hotsand 提到「ご注意を」 |
| product_intro | 0/11       | 全部都有 `.top_text`          |
| spec          | 0/11       | 全部都有規格表                |
| features      | 0/11       | 全部都有特性說明              |

## 🎯 最佳 Selector 建議

### 核心欄位

```javascript
{
  "product_code": "table th:contains('品番') + td",
  "product_name": "title (使用 regex 分割)",
  "desc": ".top_text p",
  "spec": "#specification table",
  "features": "#feature .flex > div",
  "keywords": "#tags ul li"
}
```

### 圖片欄位

```javascript
{
  "main": ".item_name figure img",
  "thema": ".mainimg img",
  "slides": "#item_slide > div img",
  "features": "#feature figure img"
}
```

## 💡 優化建議

### 1. Selector 配置化

- ✅ 已建立 `field_selectors.json` 和 `image_selectors_optimized.json`
- ✅ 支援 fallback 機制
- ✅ 支援 regex 處理

### 2. 錯誤處理

- ✅ 全形字元自動轉換
- ✅ 缺失欄位使用預設值
- ✅ 圖片下載失敗記錄

### 3. 擴展性

- ✅ 新增產品只需確認 HTML 結構一致
- ✅ 特殊處理可透過配置檔調整
- ✅ 支援 YouTube 影片等多媒體內容

## 🚀 使用方式

### 執行優化版爬蟲

```bash
cd 4w1h-min/scripts
python crawl_optimized.py
```

### 自訂 Selector

編輯 `field_selectors.json` 或 `image_selectors_optimized.json`
即可調整抓取邏輯。

## 📈 未來改進方向

1. **智慧 Selector 推導**：自動分析新產品頁面並建議最佳 selector
2. **視覺化差異比對**：標示各產品 HTML 結構的差異處
3. **資料品質監控**：自動檢測缺失或異常的資料
4. **多語言支援**：擴展至其他語言版本的產品頁面

---

> 🤖 此報告由 Selector Oracle ✨ 自動產生 專為 AI 實體語義結構感知所設計的 HTML
> selector 推導引擎

### **我們的奮鬥紀錄：從混亂到秩序，從功能到美學的旅程**

我們將一個充滿變數、容易出錯的手動流程，改造成了一個自動化、可預測、且高度客製化的「產品頁面生成引擎」。核心成果總結如下：

**第一階段：奠定秩序的基石 —— 資料統一**

1. **洞察問題**：我們透過 `analyze_json_structures.py`
   腳本，科學地診斷出所有問題的根源：`analysis.json`
   檔案存在至少兩種截然不同的結構，導致模板無法統一處理。
2. **發現真相之源**：您提供了關鍵的 `update_json_with_crops1.log`
   日誌檔案，這是整個重構的轉捩點。它包含了 AI
   對所有裁切圖最原始、最正確的分類結果。
3. **重建單一事實**：我們編寫並執行了
   `rebuild_analysis_from_log.py`，將日誌中的原始資料，反向工程並重建了**所有產品**的
   `analysis.json`。**這一步，讓我們擁有了一致、可靠、巢狀的資料基礎，一勞永逸地解決了資料不統一的問題。**

**第二階段：打造智慧的大腦 —— 邏輯升級**

1. **腳本進化**：我們重構了
   `scripts/generate_html_std.py`，使其能夠完全理解並解析這種新的、巢狀的、以「母圖」為核心的資料結構。
2. **模板革新**：我們徹底改造了
   `index_template_std.html.jinja`，使其能與新的資料結構完美協作，並加入了關鍵的「智慧判斷」能力。

**第三階段：雕琢極致的靈魂 —— 呈現優化 (以 `product_956` 為例)**

我們以 `product_956` 為「黃金標準」，進行了一系列精細的打磨：

1. **內容純化**：清理了 `analysis.json` 中的所有韓文、無用欄位
   (`features`)，並將規格文字從圖片中解放出來，轉移到結構化的 `specs` 區塊。
2. **版面革新**：
   - 實現了「**文字即內容**」：讓模板能判斷
     `text_blocks`，自動將「文字圖片」渲染為純文字。
   - 確立了**視覺階層**：實現了指定「主圖 (Hero Image)」和「主說明圖 (Main
     Description Image)」的機制。
   - 追求**極簡主義**：移除了所有區塊標題 (`<h2>`) 和產品標題
     (`<h1>`)，讓視覺焦點完全落在產品本身。
   - 優化**視覺流動**：透過 CSS
     調整，縮小了圖片間的垂直間距，使排版更緊湊、更連貫。

**目前狀態**：我們已經擁有一個完美的、經過千錘百鍊的範本
(`product_956`)，以及一套能精準執行我們意圖的自動化工具。我們距離完成所有產品頁面的重構，只剩下最後一步：讓腳本對所有產品進行一次性的全面生成。

---

### **給您另一個專案的待辦事項框架**

面對死線，清晰的思路就是最強大的武器。請將此框架複製使用，一次只專注一件事。

**🎯 第一步：釐清目標 (Define)**

- `[ ]` 今天的死線，**最不可或缺 (Must-Have)**
  的交付成果是什麼？（例如：功能A能跑、頁面B要上線）
- `[ ]` 如果有餘裕，**最好能有 (Should-Have)** 的成果是什麼？
- `[ ]` 誰是最終的驗收者？他們的標準是什麼？

**📦 第二步：盤點資源 (Inventory)**

- `[ ]` 我手上已經具備了哪些必要的檔案、資料、或權限？
- `[ ]` 我還缺少什麼？需要向誰請求支援？（請立刻發出請求）
- `[ ]` 有哪些部分可以沿用舊的程式碼或範本？

**🚀 第三步：規劃執行 (Action Plan)**

- `[ ]` **任務拆解**：將「必須完成」的目標，拆解成可以一步步執行的小任務。
  - `[ ]` 任務 1：
  - `[ ]` 任務 2：
  - `[ ]` 任務 3：
- `[ ]` **預估時間**：為每個小任務標上預計花費的時間。
- `[ ]` **排序優先級**：從最關鍵、最核心的任務開始執行。

**✅ 第四步：檢查與交付 (Review & Deliver)**

- `[ ]` 預留至少 1 小時作為測試和緩衝時間。
- `[ ]` 在交付前，自己先完整地走一遍使用者流程。
- `[ ]` 準備好交付的檔案、說明文件或部署指令。
